{% extends "base.html" %}

{% block title %}
<title>QuorAI - Answers with AI</title>
{% endblock %}


{% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}" />
{% endblock %}


{% block main %}
<div class="container">
    <div class="row clearfix">
        <div class="homepage-nav col-md-3 column">
            <a class="btn btn-warning bg-gradient text-white px-3 mx-5" href="{{ url_for('newDiscussion') }}">Start a
                Question</a>
            <ul class="nav flex-column mt-4 mx-5">
                <li class="nav-item mb-1">
                    <a class="nav-link text-secondary hover-orange" href= "/">
                        <i class="bi bi-archive-fill"></i>
                        <span class="Button-label">All</span>
                    </a>
                </li>
                {% for category in categories %}
                <li class="nav-item mb-1">
                    <a class="nav-link text-secondary hover-orange" href="?category={{ category.id }}">
                        <i class="{{ category.iconClass }}"></i>
                        <span class="Button-label">{{ category.name }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="homepage-results col-md-9 column">
            <div class="dropdown">
                <button type="button" class="btn btn-secondary bg-gradient dropdown-toggle"
                    data-bs-toggle="dropdown">Latest</button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Latest</a></li>
                    <li><a class="dropdown-item" href="#">Top</a></li>
                    <li><a class="dropdown-item" href="#">Newest</a></li>
                    <li><a class="dropdown-item" href="#">Oldest</a></li>
                    <li><a class="dropdown-item" href="#">Trending</a></li>
                    <li><a class="dropdown-item" href="#">Upvotes</a></li>
                    <li><a class="dropdown-item" href="#">Most backed</a></li>
                </ul>
            </div>
            {% if paginate.total == 0 %}
            <h4 class="text-center mt-4 text-secondary" role="alert">
                No discussions found.
            </h4>
            {% else %}
            <ul class="discussion-list list-unstyled">

                {% for post in paginate.items %}
                <li>
                    <div class="row clearfix">
                        <div class="col-md-10 column row clearfix">
                            <div class="col-md-1 column">
                                <img alt="Avatar" src='https://robohash.org/{{ post.author.email }}' class="rounded-circle"
                                    style="width: 50px; height: 50px;" />
                            </div>

                            <div class="col-md-11">
                                <h5>
                                    <a href="{{ url_for('postDetails', post_id=post.id) }}" style="text-decoration: none; color: inherit;" onmouseover="this.style.color='#007bff'" onmouseout="this.style.color='inherit'">{{ post.title }}</a>
                                </h5>
                                <p>
                                    <i class="bi bi-reply-fill"></i>
                                    Publish Date: <span id="humanTimestamp_{{ post.id }}"></span>
                                </p>
                                <p>
                                    {{ post.body }}
                                </p>
                            </div>

                        </div>
                        <div class="col-md-2 column">
                            <div class="row clearfix">
                                <div class="col-md-6 column">
                                    <span class="badge category-tag" data-category-id="{{ post.category.id }}">{{ post.category.name }}</span>
                                </div>
                                <div class="col-md-6 column text-secondary">
                                    <p>
                                        <i class="bi bi-chat-right-heart-fill"></i>
                                        {{ post.comments.all()|length }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                {% endfor %}
            </ul>
            <ul class="pagination justify-content-center mb-5">
                <li {% if not paginate.has_prev %}class="page-item disabled" {% else %}class="page-item" {% endif %}><a
                        class="page-link" href="{{ url_for('index') }}?page={{ paginate.prev_num }}"
                        aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
                {% for num in range(1, paginate.pages+1) %}
                <li {% if num==paginate.page %}class="page-item active" {% else %}class="page-item" {% endif %}><a
                        class="page-link" href="{{ url_for('index') }}?page={{ num }}">{{ num }}</a></li>
                {% endfor %}
                <li {% if not paginate.has_next %}class="page-item disabled" {% else %}class="page-item" {% endif %}><a
                        class="page-link" href="{{ url_for('index') }}?page={{ paginate.next_num }}"
                        aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
            </ul>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}


{% block script %}
<script src="{{ url_for('static', filename='js/index.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% for post in paginate.items %}
            var timestamp_{{ post.id }} = '{{ post.timestamp }}';
            var momentTimestamp_{{ post.id }} = moment(timestamp_{{ post.id }});
            var now = moment();
            var diffInHours_{{ post.id }} = now.diff(momentTimestamp_{{ post.id }}, 'hours');
            var element_{{ post.id }} = document.getElementById('humanTimestamp_{{ post.id }}');

            if (diffInHours_{{ post.id }} < 24) {
                element_{{ post.id }}.textContent = momentTimestamp_{{ post.id }}.fromNow();
            } else {
                element_{{ post.id }}.textContent = momentTimestamp_{{ post.id }}.format('YYYY-MM-DD HH:mm:ss');
            }
        {% endfor %}
    });
</script>
{% endblock %}